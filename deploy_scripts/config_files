#!/bin/bash
#Changing the executor permissions
sudo chmod -R 777 /home/ubuntu/projects/executor/
sudo chmod 777 /home/ubuntu/projects/executor/gradlew

#Setting the cloud key
#The cloud key it's located in a external config.json file
if [[ -f "/home/ubuntu/config.json" ]]; then
  echo "Config File exists"

  #Changing portal route to the proper one in the config file
  muuktestRoute=$(cat /home/ubuntu/config.json  | jq -r '.BERoute')
  echo $muuktestRoute
  sudo sed -i "s_https://portal.muuktest.com:8081_"$muuktestRoute"_" /home/ubuntu/projects/executor/mkcli.py

  # Adding the cloudKey in the mkcloud.py file
  cloudKey=$(cat /home/ubuntu/config.json  | jq -r '.cloudKey')
  sudo sed -i '$ a def getCloudKey():' /home/ubuntu/projects/executor/mkcloud.py
  sudo sed -i "$ a  \ \ return('$cloudKey')" /home/ubuntu/projects/executor/mkcloud.py
fi